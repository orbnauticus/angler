#!/usr/bin/env python3

from angler.core import Manifest, default_manifest
from angler.command import Add
from angler.util import uri, key_value

import argparse
import cmd
import shlex


class AnglerShell(cmd.Cmd):
    def __init__(self, manifest):
        super(AnglerShell, self).__init__()
        self.manifest = manifest
        self.prompt = 'angler:{}âŸ« '.format(manifest.database)

    def do_exit(self, arg):
        return True

    def do_EOF(self, arg):
        print('exit')
        return True

    def do_add(self, arg):
        try:
            add = Add.from_arguments(self.manifest, shlex.split(arg))
        except SystemExit:
            return

        print('Would add node', add.uri, add.status)

        if False:
            add.run()

    def help_add(self):
        print(Add.help())


if __name__ == '__main__':

    parser = argparse.ArgumentParser()

    parser.add_argument('manifest', nargs='?', default=default_manifest)

    args = parser.parse_args()

    manifest = Manifest(args.manifest)

    try:
        AnglerShell(manifest).cmdloop()
    except KeyboardInterrupt:
        print()
        exit(0)
